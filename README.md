# DB部署工具

一款基于Electron开发的现代化DB部署工具，采用VSCode风格的无边框界面设计，专为数据库开发和运维人员打造，支持PostgreSQL数据库的SQL文件批量执行和管理。

## ✨ 功能特性

### 🎯 核心功能
- **智能目录扫描**: 递归扫描指定目录下所有子目录中的SQL文件，自动按文件夹分组
- **可视化文件管理**: 树形结构展示SQL文件，支持按第一级子目录名进行分组显示
- **多数据库支持**: 支持PostgreSQL、MySQL、Oracle、SQL Server等主流数据库（当前主要实现PostgreSQL）
- **拖拽式部署**: 直观的拖拽操作，支持文件夹拖拽到部署队列
- **智能排序**: 部署队列内支持拖拽重新排序，灵活调整执行顺序
- **批量执行**: 按用户指定顺序批量执行SQL文件，支持跳过错误继续执行
- **实时监控**: 实时显示执行进度、成功/失败状态和详细执行日志
- **配置管理**: 数据库连接配置可保存到本地，支持密码保存（可选）

### 🎨 界面特色
- **现代化设计**: 仿VSCode的无边框窗口设计，支持自定义标题栏
- **深色主题**: 护眼的深色主题界面，符合开发者使用习惯
- **响应式布局**: 左侧边栏+主工作区的经典布局，界面简洁高效
- **状态指示**: 实时连接状态指示器（红/绿/黄色），一目了然
- **交互反馈**: 丰富的视觉反馈，包括拖拽高亮、加载动画等

### 🔧 高级功能
- **连接测试**: 独立的数据库连接测试功能，验证配置正确性
- **错误处理**: 智能错误识别和友好的错误提示信息
- **执行控制**: 支持跳过错误继续执行，提高部署成功率
- **日志管理**: 详细的执行日志，支持清空和实时滚动
- **进度追踪**: 可视化进度条，实时显示执行进度

## 🚀 安装和运行

### 环境要求
- **Node.js**: 16.0 或更高版本
- **npm**: 包管理器
- **操作系统**: Windows、macOS、Linux

### 快速开始
```bash
# 克隆项目
git clone <repository-url>
cd sql-deployment-tool

# 安装依赖
npm install

# 开发模式运行（推荐）
npm run dev

# 生产模式运行
npm start
```

### 构建应用
```bash
# 构建可执行文件
npm run build
```

## 📖 使用指南

### 1. 项目目录选择
1. 点击左侧边栏的"选择目录"按钮
2. 选择包含SQL文件的根目录
3. 工具会自动递归扫描所有子目录中的`.sql`文件
4. 文件按第一级子目录进行分组显示

### 2. 数据库连接配置
1. 点击"配置连接"按钮打开配置弹窗
2. 填写数据库连接信息：
   - **数据库类型**: PostgreSQL、MySQL、Oracle、SQL Server
   - **主机地址**: 数据库服务器地址（默认：localhost）
   - **端口号**: 数据库端口（PostgreSQL默认：5432）
   - **数据库名称**: 目标数据库名
   - **用户名**: 数据库用户名
   - **密码**: 数据库密码
3. 勾选"保存配置"可将配置保存到本地（包括密码）
4. 点击"测试连接"验证配置正确性

### 3. SQL文件部署
1. **添加到队列**: 从左侧文件树拖拽文件夹到右侧部署队列
2. **调整顺序**: 在部署队列中拖拽调整执行顺序
3. **开始部署**: 点击"开始部署"按钮执行SQL文件
4. **监控执行**: 在日志区域实时查看执行结果和进度
5. **错误处理**: 可选择跳过错误继续执行后续文件

### 4. 日志和监控
- **实时日志**: 显示每个SQL文件的执行状态
- **进度条**: 可视化显示整体执行进度
- **错误详情**: 详细的错误信息和建议
- **清空功能**: 支持清空队列和日志

## 📁 项目结构

```
sql-deployment-tool/
├── main.js              # Electron主进程，处理窗口管理和IPC通信
├── renderer.js          # 渲染进程逻辑，UI交互和业务逻辑
├── index.html           # 主界面HTML结构
├── styles.css           # 完整的CSS样式定义
├── package.json         # 项目配置和依赖管理
├── package-lock.json    # 依赖版本锁定
└── README.md           # 项目文档
```

### 核心文件说明
- **main.js**: 包含Electron主进程逻辑，IPC处理器，数据库连接管理
- **renderer.js**: 前端交互逻辑，拖拽功能，UI状态管理
- **index.html**: 界面结构，包含自定义标题栏和模态弹窗
- **styles.css**: VSCode风格的深色主题样式

## 🛠 技术栈

### 核心技术
- **Electron**: 跨平台桌面应用开发框架
- **Node.js**: JavaScript运行时环境
- **PostgreSQL**: 主要支持的数据库（通过pg库）

### 依赖库
- **pg**: PostgreSQL数据库客户端
- **fs-extra**: 增强的文件系统操作
- **electron-builder**: 应用打包和分发

### 前端技术
- **原生HTML/CSS/JavaScript**: 无框架依赖，轻量高效
- **CSS Grid/Flexbox**: 现代化布局技术
- **拖拽API**: 原生HTML5拖拽功能

## ⚠️ 重要说明

### 安全注意事项
1. **密码存储**: 配置保存功能会将密码以明文形式存储在本地localStorage中
2. **生产环境**: 建议生产环境使用时谨慎保存密码配置
3. **权限管理**: 确保数据库用户具有足够的执行权限

### 使用限制
1. **数据库支持**: 当前主要实现PostgreSQL，其他数据库类型为预留接口
2. **文件格式**: 仅识别`.sql`扩展名的文件
3. **执行顺序**: 严格按照部署队列中的顺序执行，无并发执行
4. **连接管理**: 每次部署会重新建立数据库连接

### 性能考虑
- 大量SQL文件执行时建议分批处理
- 复杂SQL语句可能需要较长执行时间
- 网络延迟会影响数据库连接和执行速度

## 🔧 故障排除

### 常见问题

**Q: 应用启动失败或白屏**
A: 
- 检查Node.js版本是否≥16.0
- 确认已正确执行`npm install`
- 尝试删除`node_modules`重新安装依赖

**Q: 数据库连接失败**
A:
- 验证数据库服务是否正常运行
- 检查主机地址、端口号是否正确
- 确认用户名密码是否正确
- 检查网络连接和防火墙设置
- 验证数据库是否存在

**Q: SQL文件未被扫描到**
A:
- 确保文件扩展名为`.sql`
- 检查文件是否位于选择目录的子目录中
- 验证文件权限是否可读

**Q: SQL执行失败**
A:
- 查看日志区域的详细错误信息
- 检查SQL语法是否正确
- 验证数据库用户权限
- 确认依赖的表或对象是否存在

**Q: 拖拽功能不工作**
A:
- 确保拖拽的是文件夹而非单个文件
- 检查浏览器是否支持HTML5拖拽API
- 尝试重新启动应用

## 🔨 开发指南

### 开发环境设置
```bash
# 开发模式（自动打开开发者工具）
npm run dev

# 调试模式
npm start
```

### 调试技巧
- **开发者工具**: F12打开Chrome DevTools
- **控制台日志**: 查看详细的执行日志
- **网络监控**: 监控IPC通信
- **断点调试**: 在renderer.js中设置断点
- **主进程调试**: 查看终端输出的主进程日志

### 代码结构
- **IPC通信**: 主进程和渲染进程通过IPC进行通信
- **事件驱动**: 基于DOM事件和IPC事件的架构
- **状态管理**: 使用全局变量管理应用状态
- **模块化**: 功能按模块组织，便于维护

## 📄 许可证

MIT License - 详见LICENSE文件

## 🤝 贡献

欢迎贡献代码！请遵循以下步骤：

1. Fork本项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建Pull Request

### 贡献指南
- 遵循现有代码风格
- 添加适当的注释
- 更新相关文档
- 确保功能测试通过

## 📞 支持

如果您遇到问题或有建议，请：
- 提交Issue描述问题
- 查看已有Issue寻找解决方案
- 参与讨论和改进建议

---

**⚡ 提示**: 本工具专为开发和测试环境设计，生产环境使用前请充分测试并做好数据备份。